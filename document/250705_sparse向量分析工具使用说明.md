# Sparseå‘é‡åˆ†æå·¥å…·ä½¿ç”¨è¯´æ˜

**ç”Ÿæˆæ—¶é—´**: 2024-12-01  
**å·¥å…·ç‰ˆæœ¬**: 1.0.0

## æ¦‚è¿°

Sparseå‘é‡åˆ†æå·¥å…·ç”¨äºåˆ†æchunkæ–‡ä»¶ä¸­sparseå‘é‡ç”Ÿæˆæƒ…å†µï¼Œæ”¯æŒåŠ¨æ€è°ƒæ•´BM25å‚æ•°ï¼Œè¯†åˆ«ç©ºsparseå‘é‡å¹¶ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **åŠ¨æ€å‚æ•°è°ƒæ•´**: æ”¯æŒä¸´æ—¶è°ƒæ•´BM25çš„min_freqå’Œmax_vocab_sizeå‚æ•°
- ğŸ“Š **è¯¦ç»†åˆ†æ**: åˆ†æchunkæ–‡æœ¬ç‰¹å¾ã€sparseå‘é‡ç»Ÿè®¡ã€è¯æ±‡è¡¨è¦†ç›–ç‡
- ğŸ¯ **ç©ºå‘é‡è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å¹¶åˆ†æç©ºsparseå‘é‡çš„åŸå› 
- ğŸ“ˆ **æ™ºèƒ½å»ºè®®**: åŸºäºåˆ†æç»“æœç”Ÿæˆæ”¹è¿›å»ºè®®
- ğŸ“ **å®Œæ•´æŠ¥å‘Š**: ç”ŸæˆJSONæ ¼å¼çš„è¯¦ç»†åˆ†ææŠ¥å‘Š

## å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹PythonåŒ…ï¼š
```bash
pip3 install jieba
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°åˆ†æ
python3 evaltool/analyze_sparse.py data/chunks.json

# è°ƒæ•´BM25å‚æ•°
python3 evaltool/analyze_sparse.py data/chunks.json --min_freq 3 --max_vocab 15000

# ä½¿ç”¨ç°æœ‰è¯å…¸ï¼ˆä¸é‡æ–°ç”Ÿæˆï¼‰
python3 evaltool/analyze_sparse.py data/chunks.json --no_gen_dict

# æŒ‡å®šè¾“å‡ºæŠ¥å‘Šè·¯å¾„
python3 evaltool/analyze_sparse.py data/chunks.json --output report.json
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `chunk_file` | - | æ–‡ä»¶è·¯å¾„ | å¿…éœ€ | chunkæ–‡ä»¶è·¯å¾„ |
| `--min_freq` | `-mf` | æ•´æ•° | 5 | æœ€å°è¯é¢‘ |
| `--max_vocab` | `-mv` | æ•´æ•° | 10000 | æœ€å¤§è¯æ±‡è¡¨å¤§å° |
| `--no_gen_dict` | `-ngd` | æ ‡å¿— | False | ä¸é‡æ–°ç”Ÿæˆè¯å…¸ |
| `--output` | `-o` | æ–‡ä»¶è·¯å¾„ | evaltool/sparse_analysis_report.json | è¾“å‡ºæŠ¥å‘Šè·¯å¾„ |
| `--no_headers` | `-nh` | æ ‡å¿— | False | ä¸åŒ…å«æ ‡é¢˜ä¿¡æ¯ |
| `--verbose` | `-v` | æ ‡å¿— | False | è¯¦ç»†è¾“å‡º |

## è¾“å‡ºæŠ¥å‘Šæ ¼å¼

åˆ†æå®Œæˆåä¼šç”ŸæˆJSONæ ¼å¼çš„æŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

### 1. æŠ¥å‘Šä¿¡æ¯ (report_info)
```json
{
  "timestamp": "20241201_143022",
  "generated_at": "2024-12-01T14:30:22",
  "tool_version": "1.0.0"
}
```

### 2. é…ç½®ä¿¡æ¯ (configuration)
```json
{
  "min_freq": 5,
  "max_vocab_size": 10000,
  "include_headers": true,
  "dict_file": "dict/userdict_20241201_143022.json"
}
```

### 3. æ‘˜è¦ä¿¡æ¯ (summary)
```json
{
  "total_chunks": 1000,
  "empty_sparse_count": 50,
  "empty_sparse_rate": 0.05,
  "vocabulary_size": 5000,
  "vocab_coverage_rate": 0.85
}
```

### 4. è¯¦ç»†åˆ†æ (detailed_analysis)
- **sparse_vector_stats**: sparseå‘é‡ç»Ÿè®¡ä¿¡æ¯
- **vocabulary_stats**: è¯æ±‡è¡¨ç»Ÿè®¡ä¿¡æ¯
- **vocabulary_coverage**: è¯æ±‡è¡¨è¦†ç›–ç‡åˆ†æ
- **empty_sparse_chunks**: ç©ºsparseå‘é‡çš„chunkåˆ—è¡¨

### 5. æ”¹è¿›å»ºè®® (recommendations)
```json
[
  "ç©ºsparseå‘é‡æ¯”ä¾‹è¾ƒé«˜(15.00%)ï¼Œå»ºè®®è°ƒæ•´BM25å‚æ•°",
  "è¯æ±‡è¦†ç›–ç‡è¾ƒä½(45.00%)ï¼Œå»ºè®®é™ä½min_freqæˆ–å¢åŠ max_vocab_size"
]
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€åˆ†æ
```bash
python3 evaltool/analyze_sparse.py data/chunks.json
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
å¼€å§‹åˆ†æchunkæ–‡ä»¶: data/chunks.json
é…ç½®: min_freq=5, max_vocab_size=10000
åŒ…å«æ ‡é¢˜: True
ç”Ÿæˆæ–°è¯å…¸: True

============================================================
SPARSEå‘é‡åˆ†ææŠ¥å‘Šæ‘˜è¦
============================================================
æ€»chunkæ•°é‡: 1000
ç©ºsparseå‘é‡æ•°é‡: 50
ç©ºsparseå‘é‡æ¯”ä¾‹: 5.00%
è¯æ±‡è¡¨å¤§å°: 5000
è¯æ±‡è¦†ç›–ç‡: 85.00%

æ”¹è¿›å»ºè®®:
  1. å½“å‰é…ç½®è¡¨ç°è‰¯å¥½ï¼Œæ— éœ€è°ƒæ•´
============================================================

è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°: evaltool/sparse_analysis_report.json
```

### ç¤ºä¾‹2: å‚æ•°è°ƒä¼˜
```bash
python3 evaltool/analyze_sparse.py data/chunks.json --min_freq 3 --max_vocab 15000 --verbose
```

### ç¤ºä¾‹3: ä½¿ç”¨ç°æœ‰è¯å…¸
```bash
python3 evaltool/analyze_sparse.py data/chunks.json --no_gen_dict --output custom_report.json
```

## åˆ†ææŒ‡æ ‡è¯´æ˜

### ç©ºsparseå‘é‡æ¯”ä¾‹
- **ç›®æ ‡**: < 10%
- **å«ä¹‰**: æ— æ³•ç”Ÿæˆsparseå‘é‡çš„chunkæ¯”ä¾‹
- **æ”¹è¿›**: é™ä½min_freqæˆ–å¢åŠ max_vocab_size

### è¯æ±‡è¡¨è¦†ç›–ç‡
- **ç›®æ ‡**: > 70%
- **å«ä¹‰**: chunkä¸­è¯æ±‡åœ¨BM25è¯æ±‡è¡¨ä¸­çš„è¦†ç›–ç‡
- **æ”¹è¿›**: é™ä½min_freqæˆ–å¢åŠ max_vocab_size

### è¯æ±‡è¡¨å¤§å°
- **æ¨èèŒƒå›´**: 1000-50000
- **è¿‡å°**: è¯æ±‡è¦†ç›–ç‡ä½ï¼Œç©ºå‘é‡å¤š
- **è¿‡å¤§**: è®¡ç®—å¼€é”€å¤§ï¼Œå¯èƒ½è¿‡æ‹Ÿåˆ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ‰¾ä¸åˆ°chunkæ–‡ä»¶**
   ```
   é”™è¯¯: chunkæ–‡ä»¶ä¸å­˜åœ¨: data/chunks.json
   ```
   **è§£å†³**: æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

2. **è¯å…¸ç”Ÿæˆå¤±è´¥**
   ```
   ç”Ÿæˆè¯å…¸å¤±è´¥: [é”™è¯¯ä¿¡æ¯]
   ```
   **è§£å†³**: æ£€æŸ¥dataç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„è¾“å…¥æ–‡ä»¶

3. **æ¨¡å—å¯¼å…¥é”™è¯¯**
   ```
   æ— æ³•å¯¼å…¥BM25Manageræ¨¡å—
   ```
   **è§£å†³**: ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼Œæˆ–è®¾ç½®PYTHONPATH

### è°ƒè¯•æ¨¡å¼

ä½¿ç”¨`--verbose`å‚æ•°è·å–è¯¦ç»†æ—¥å¿—ï¼š
```bash
python3 evaltool/analyze_sparse.py data/chunks.json --verbose
```

## æŠ€æœ¯æ¶æ„

å·¥å…·é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

- **SparseAnalyzerConfig**: é…ç½®ç®¡ç†
- **ChunkProcessor**: chunkå¤„ç†å’Œæ–‡æœ¬åˆ†æ
- **BM25Manager**: BM25è¯å…¸ç”Ÿæˆå’Œå‘é‡è®¡ç®—
- **SparseAnalyzer**: ä¸»åˆ†æå™¨ï¼Œæ•´åˆæ‰€æœ‰åŠŸèƒ½

## ç‰ˆæœ¬å†å²

- **v1.0.0** (2024-12-01): åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºç¡€sparseå‘é‡åˆ†æåŠŸèƒ½ 